<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MQLUNIT: MQLUNIT Cookbook</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MQLUNIT
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">MQLUNIT Cookbook </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Here is a short cookbook to help you get started.</p>
<h2>Simple Test Case</h2>
<p>You want to know whether your code is working.</p>
<p>How do you do it?</p>
<p>There are many ways. Stepping through a debugger or littering your code with Print output calls are two of the simpler ways, but they both have drawbacks. Stepping through your code is a good idea, but it is not automatic. You have to do it every time you make changes. Printing out text is also fine, but it makes code ugly and it generates far more information than you need most of the time.</p>
<p>Tests in MQLUNIT can be run automatically. They are easy to set up and once you have written them, they are always there to help you keep confidence in the quality of your code.</p>
<p>This is especially important while working with MQL4 language as MetaTrader 4 get constant updates that tend to break woking code. Having a unit test suite helps to quickly verify the functionality of your code.</p>
<p>To make a simple test, here is what you do:</p>
<p>Subclass the <a class="el" href="classMQLUNIT__TestCase.html" title="A test case defines the fixture to run multiple tests. ">MQLUNIT_TestCase</a> class. Make sure to add two constructors as in the example below.</p>
<p>Use <a class="el" href="MQLUNIT_8mqh.html#a262b6fc68f99bccdf48251b6d1964823">MQLUNIT_START</a> to denote the beginning of the tests block.</p>
<p>Use <a class="el" href="MQLUNIT_8mqh.html#af19cf2a82cf274bf7c72dfa8286bc36e">TEST_START</a> and <a class="el" href="MQLUNIT_8mqh.html#a806749d46ee4a9acd0a9d9e416f80d98">TEST_END</a> macros to add a single test method.</p>
<p>Close the tests block with <a class="el" href="MQLUNIT_8mqh.html#af2419fce979f62ff6fb8af68a1bae034">MQLUNIT_END</a> macro.</p>
<p>When you want to check a value, call <a class="el" href="MQLUNIT_8mqh.html#aea1e5a96e1e9b6fe711aad72b857c5ca">ASSERT_TRUE(string, bool)</a> and pass in an expression that is true if the test succeeds along with a string message to be displayed if the test fails (you can pass an empty string <code>""</code> if you wish to use a default message).</p>
<p>For example, to test the equality comparison for a Complex number class, write:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>ComplexNumberTest : <span class="keyword">public</span> <a class="code" href="classMQLUNIT__TestCase.html">MQLUNIT_TestCase</a> { </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    ComplexNumberTest() : <a class="code" href="classMQLUNIT__TestCase.html">MQLUNIT_TestCase</a>(typename(this))  {};</div><div class="line">    ComplexNumberTest(<span class="keywordtype">string</span> name) : <a class="code" href="classMQLUNIT__TestCase.html">MQLUNIT_TestCase</a>(name) {};</div><div class="line"></div><div class="line">    <a class="code" href="MQLUNIT_8mqh.html#a262b6fc68f99bccdf48251b6d1964823">MQLUNIT_START</a></div><div class="line"></div><div class="line">    <a class="code" href="MQLUNIT_8mqh.html#af19cf2a82cf274bf7c72dfa8286bc36e">TEST_START</a>(ComplexNumber) {</div><div class="line">        Complex(10, 1) c1;</div><div class="line">        Complex(10, 1) c2;</div><div class="line"></div><div class="line">        <a class="code" href="MQLUNIT_8mqh.html#aea1e5a96e1e9b6fe711aad72b857c5ca">ASSERT_TRUE</a>(&quot;&quot;, c1 == c2);</div><div class="line"></div><div class="line">        Complex (1, 1) c3;</div><div class="line">        Complex (2, 2) c4;</div><div class="line"></div><div class="line">        <a class="code" href="MQLUNIT_8mqh.html#aea1e5a96e1e9b6fe711aad72b857c5ca">ASSERT_TRUE</a>(&quot;&quot;, !(c3 == c4));</div><div class="line">    }</div><div class="line">    <a class="code" href="MQLUNIT_8mqh.html#a806749d46ee4a9acd0a9d9e416f80d98">TEST_END</a></div><div class="line"></div><div class="line">    <a class="code" href="MQLUNIT_8mqh.html#af2419fce979f62ff6fb8af68a1bae034">MQLUNIT_END</a></div><div class="line">};</div></div><!-- fragment --><p>You only need to include a single file in your code to import all MQLUNIT functionality:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="MQLUNIT_8mqh.html">MQLUNIT/MQLUNIT.mqh</a>&gt;</span></div></div><!-- fragment --><p>Ordinarily, you'll have many little test cases that you'll want to run on the same set of objects. To do this, we will improve on this example.</p>
<h2>Fixture</h2>
<p>A fixture is a known set of objects that serves as a base for a set of test cases. Fixtures come in very handy when you are testing as you develop.</p>
<p>Let's try out this style of development and learn about fixtures along the away. Suppose that we are really developing a complex number class. Let's start by defining a empty class named Complex.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>Complex {};</div></div><!-- fragment --><p>Now create an instance of ComplexNumberTest above, compile the code and see what happens. The first thing we notice is a few compiler errors. The test uses operator ==, but it is not defined. Let's fix that.</p>
<div class="fragment"><div class="line"><span class="keywordtype">bool</span> operator==(<span class="keyword">const</span> Complex &amp;that) { </div><div class="line">  <span class="keywordflow">return</span> <span class="keyword">true</span>; </div><div class="line">}</div></div><!-- fragment --><p>Now compile the test, and run it. This time it compiles but the test fails. We need a bit more to get an operator ==working correctly, so we revisit the code.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>Complex { </div><div class="line"><span class="keyword">private</span></div><div class="line">    <span class="keywordtype">double</span> real, imaginary;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Complex(<span class="keywordtype">double</span> r, <span class="keywordtype">double</span> i = 0) : real(r) , imaginary(i) {}; </div><div class="line">    <span class="keywordtype">bool</span> operator ==(<span class="keyword">const</span> Complex &amp;that) {}</div><div class="line">        <span class="keywordflow">return</span> this.real == that.real  &amp;&amp;  this.imaginary == that.imaginary; </div><div class="line">    }</div><div class="line">};</div></div><!-- fragment --><p>If we compile now and run our test it will pass.</p>
<p>Now we are ready to add new operations and new tests. At this point a fixture would be handy. We would probably be better off when doing our tests if we decided to instantiate three or four complex numbers and reuse them across our tests.</p>
<p>Here is how we do it:</p>
<ul>
<li>Add member variables for each part of the fixture</li>
<li>Override <a class="el" href="classMQLUNIT__TestCase.html#a59a95eda39dd2ac7292a28e218b010ce" title="Set up context before running a test. ">MQLUNIT_TestCase::setUp()</a> to initialize the variables</li>
<li>Override <a class="el" href="classMQLUNIT__TestCase.html#ac52a95e87f26e13cc07ef8b787f7f99f" title="Clean up after the test run. ">MQLUNIT_TestCase::tearDown()</a> to release any permanent resources you allocated in <a class="el" href="classMQLUNIT__TestCase.html#a59a95eda39dd2ac7292a28e218b010ce" title="Set up context before running a test. ">MQLUNIT_TestCase::setUp()</a></li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">class </span>ComplexNumberTest : <span class="keyword">public</span> <a class="code" href="classMQLUNIT__TestCase.html">MQLUNIT_TestCase</a> { </div><div class="line"><span class="keyword">private</span>:</div><div class="line">    Complex* m_10_1;</div><div class="line">    Complex* m_1_1;</div><div class="line">    Complex* m_11_2;</div><div class="line"></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    ComplexNumberTest() : <a class="code" href="classMQLUNIT__TestCase.html">MQLUNIT_TestCase</a>(typename(this))  {};</div><div class="line">    ComplexNumberTest(<span class="keywordtype">string</span> name) : <a class="code" href="classMQLUNIT__TestCase.html">MQLUNIT_TestCase</a>(name) {};</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> <a class="code" href="classMQLUNIT__TestCase.html#a59a95eda39dd2ac7292a28e218b010ce">setUp</a>() {</div><div class="line">        m_10_1 = <span class="keyword">new</span> Complex(10, 1);</div><div class="line">        m_1_1 = <span class="keyword">new</span> Complex(1, 1);</div><div class="line">        m_11_2 = <span class="keyword">new</span> Complex(11, 2);  </div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> <a class="code" href="classMQLUNIT__TestCase.html#ac52a95e87f26e13cc07ef8b787f7f99f">tearDown</a>() {</div><div class="line">        <span class="keyword">delete</span> m_10_1;</div><div class="line">        <span class="keyword">delete</span> m_1_1;</div><div class="line">        <span class="keyword">delete</span> m_11_2;</div><div class="line">    }</div><div class="line">};</div></div><!-- fragment --><p>Once we have this fixture, we can add the complex addition test case and any others that we need over the course of our development.</p>
<h2>Test Case</h2>
<p>How do you write and invoke individual tests using a fixture?</p>
<p>Write the test case using <a class="el" href="MQLUNIT_8mqh.html#af19cf2a82cf274bf7c72dfa8286bc36e">TEST_START</a> and <a class="el" href="MQLUNIT_8mqh.html#a806749d46ee4a9acd0a9d9e416f80d98">TEST_END</a> macros in the fixture class between <a class="el" href="MQLUNIT_8mqh.html#a262b6fc68f99bccdf48251b6d1964823">MQLUNIT_START</a> and <a class="el" href="MQLUNIT_8mqh.html#af2419fce979f62ff6fb8af68a1bae034">MQLUNIT_END</a> macros.</p>
<p>Here is our test case class with a few extra case methods:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>ComplexNumberTest : <span class="keyword">public</span> <a class="code" href="classMQLUNIT__TestCase.html">MQLUNIT_TestCase</a> { </div><div class="line"><span class="keyword">private</span>:</div><div class="line">    Complex* m_10_1;</div><div class="line">    Complex* m_1_1;</div><div class="line">    Complex* m_11_2;</div><div class="line"></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    ComplexNumberTest() : <a class="code" href="classMQLUNIT__TestCase.html">MQLUNIT_TestCase</a>(typename(this))  {};</div><div class="line">    ComplexNumberTest(<span class="keywordtype">string</span> name) : <a class="code" href="classMQLUNIT__TestCase.html">MQLUNIT_TestCase</a>(name) {};</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> <a class="code" href="classMQLUNIT__TestCase.html#a59a95eda39dd2ac7292a28e218b010ce">setUp</a>() {</div><div class="line">        m_10_1 = <span class="keyword">new</span> Complex(10, 1);</div><div class="line">        m_1_1 = <span class="keyword">new</span> Complex(1, 1);</div><div class="line">        m_11_2 = <span class="keyword">new</span> Complex(11, 2);  </div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> <a class="code" href="classMQLUNIT__TestCase.html#ac52a95e87f26e13cc07ef8b787f7f99f">tearDown</a>() {</div><div class="line">        <span class="keyword">delete</span> m_10_1;</div><div class="line">        <span class="keyword">delete</span> m_1_1;</div><div class="line">        <span class="keyword">delete</span> m_11_2;</div><div class="line">    }</div><div class="line"></div><div class="line">    <a class="code" href="MQLUNIT_8mqh.html#a262b6fc68f99bccdf48251b6d1964823">MQLUNIT_START</a></div><div class="line"></div><div class="line">    <a class="code" href="MQLUNIT_8mqh.html#af19cf2a82cf274bf7c72dfa8286bc36e">TEST_START</a>(Equality) {</div><div class="line">        <a class="code" href="MQLUNIT_8mqh.html#aea1e5a96e1e9b6fe711aad72b857c5ca">ASSERT_TRUE</a>(<span class="stringliteral">&quot;&quot;</span>, *m_10_1 == *m_10_1);</div><div class="line">        <a class="code" href="MQLUNIT_8mqh.html#aea1e5a96e1e9b6fe711aad72b857c5ca">ASSERT_TRUE</a>(<span class="stringliteral">&quot;&quot;</span>, !(*m_10_1 == *m_11_2));</div><div class="line">    }</div><div class="line">    <a class="code" href="MQLUNIT_8mqh.html#a806749d46ee4a9acd0a9d9e416f80d98">TEST_END</a></div><div class="line"></div><div class="line">    <a class="code" href="MQLUNIT_8mqh.html#af19cf2a82cf274bf7c72dfa8286bc36e">TEST_START</a>(Addition) {</div><div class="line">        <a class="code" href="MQLUNIT_8mqh.html#aea1e5a96e1e9b6fe711aad72b857c5ca">ASSERT_TRUE</a>(<span class="stringliteral">&quot;&quot;</span>, *m_10_1 + *m_1_1 == *m_11_2);</div><div class="line">    }</div><div class="line">    <a class="code" href="MQLUNIT_8mqh.html#a806749d46ee4a9acd0a9d9e416f80d98">TEST_END</a></div><div class="line"></div><div class="line">    <a class="code" href="MQLUNIT_8mqh.html#af2419fce979f62ff6fb8af68a1bae034">MQLUNIT_END</a></div><div class="line">};</div></div><!-- fragment --><p>One may create and run instances for each test case using MQL4 script:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="MQLUNIT_8mqh.html">MQLUNIT/MQLUNIT.mqh</a>&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> OnStart() {</div><div class="line">    <a class="code" href="classMQLUNIT__TerminalTestRunner.html">MQLUNIT_TerminalTestRunner</a> runner;</div><div class="line">    runner.<a class="code" href="classMQLUNIT__TerminalTestRunner.html#ac9b9a6b9a5648b6f478602366b0d63b1">run</a>(<span class="keyword">new</span> ComplexNumberTest());</div><div class="line">}</div></div><!-- fragment --><p>Test runner takes ownership of the test, so there's no need to delete it.</p>
<p>This script will output test result to the <code>Experts</code> log window of the MetaTrader 4 terminal.</p>
<p>Once you have several tests, organise them into a suite.</p>
<h2>Test Suite</h2>
<p>How do you set up your tests so that you can run them all at once?</p>
<p>MQLUNIT provides a <a class="el" href="classMQLUNIT__TestSuite.html" title="Runs a collection of test cases. ">MQLUNIT_TestSuite</a> class that runs any number of Test Cases together.</p>
<p>We saw, above, how to run a single test case.</p>
<p>To create a suite of two or more tests, you do the following in your script:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="MQLUNIT_8mqh.html">MQLUNIT/MQLUNIT.mqh</a>&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> OnStart() {</div><div class="line">    <a class="code" href="classMQLUNIT__TestSuite.html">MQLUNIT_TestSuite</a> suite;</div><div class="line">    suite.<a class="code" href="classMQLUNIT__TestSuite.html#a581d6d11451902c6e47ebe1091f760a6">addTest</a>(<span class="keyword">new</span> ComplexNumberTest());</div><div class="line">    suite.<a class="code" href="classMQLUNIT__TestSuite.html#a581d6d11451902c6e47ebe1091f760a6">addTest</a>(<span class="keyword">new</span> AnotherTest());</div><div class="line">    suite.<a class="code" href="classMQLUNIT__TestSuite.html#a581d6d11451902c6e47ebe1091f760a6">addTest</a>(<span class="keyword">new</span> YetAnotherTest());</div><div class="line"></div><div class="line">    <a class="code" href="classMQLUNIT__TerminalTestRunner.html">MQLUNIT_TerminalTestRunner</a> runner;</div><div class="line">    runner.<a class="code" href="classMQLUNIT__TerminalTestRunner.html#ac9b9a6b9a5648b6f478602366b0d63b1">run</a>(&amp;suite);</div><div class="line">}</div></div><!-- fragment --><p>Test suite takes ownership of the added test cases, so there's no need to delete them.</p>
<p>Run this script and see the output in the <code>Experts</code> log window of the MetaTrader 4 terminal.</p>
<h2>TestRunner</h2>
<p>The <a class="el" href="classMQLUNIT__TestRunner.html" title="Base class for all test runners. ">MQLUNIT_TestRunner</a> implementations run the tests. If all the tests pass, you'll get an informative message. If any fail, you'll get the following information:</p>
<ul>
<li>The name of the test case that failed</li>
<li>The name of the source file that contains the test</li>
<li>The line number where the failure occurred</li>
<li>Failure message that you passed to the call to <a class="el" href="MQLUNIT_8mqh.html#aea1e5a96e1e9b6fe711aad72b857c5ca">ASSERT_TRUE</a> which detected the failure</li>
</ul>
<p>MQLUNIT provides the following implementations of <a class="el" href="classMQLUNIT__TestRunner.html" title="Base class for all test runners. ">MQLUNIT_TestRunner</a>:</p>
<ul>
<li><a class="el" href="classMQLUNIT__TerminalTestRunner.html" title="Test runner that outputs results to the &quot;Experts&quot; log window of MetaTrader terminal. ">MQLUNIT_TerminalTestRunner</a>: test runner that outputs results to the <code>Experts</code> log window of MetaTrader terminal.</li>
<li><a class="el" href="classMQLUNIT__ConsoleTestRunner.html" title="Test runner that outputs results to the text console. ">MQLUNIT_ConsoleTestRunner</a>: test runner that outputs results to the text console.</li>
<li><a class="el" href="classMQLUNIT__TextFileTestRunner.html" title="Test runner that outputs results to the text file. ">MQLUNIT_TextFileTestRunner</a>: test runner that outputs results to the text file.</li>
<li><a class="el" href="classMQLUNIT__XMLTestRunner.html" title="Test runner that outputs results to the XML file compatible with JUnit report analysers. ">MQLUNIT_XMLTestRunner</a>: test runner that outputs results to the XML file compatible with JUnit report analysers.</li>
</ul>
<h2>Post-build check</h2>
<p>Well, now that we have our unit tests running, how about integrating unit testing to our build process? Can we actually have one with MetaTarder 4? Fully automated?</p>
<p>The anwer is yes! MQLUNIT itsef is continuously tested on AppVeyor cloud CI.</p>
<p>You can examine <code>.appveyor.yml</code> file in the source code tree and have a look at the live build results at <a href="https://ci.appveyor.com/project/mqllab/mqlunit">https://ci.appveyor.com/project/mqllab/mqlunit</a>.</p>
<p>In a nutshell, <code>MQLUNITTest</code> script uses the output result of the call to <a class="el" href="classMQLUNIT__TestRunner.html#a0562af5be4067f8f56f0158b91af3c37" title="Run a test and output the result. ">MQLUNIT_TestRunner::run</a> method do determine if the test suite succeeded. If yes, it creates an empty <code>SUCCESS</code> file in <code>MQL4/Files/MQLUNIT</code> directory.</p>
<p>Build script uses the presence of this file to determine whether the test run was successful or not.</p>
<p>Test result in JUnit compatible XML formar are uploaded to AppVeyor and are displayed on <a href="https://ci.appveyor.com/project/mqllab/mqlunit/build/tests">the build page</a>. </p><hr/>
<p>Adapted from CppUnit Cookbook by Michael Feathers and Baptiste Lepilleur.</p>
<dl class="section author"><dt>Author</dt><dd>Egor Pervuninski (<a href="https://egor.pe">https://egor.pe</a>) </dd>
<dd>
Michael Feathers </dd>
<dd>
Baptiste Lepilleur </dd></dl>
</div></div><!-- contents -->
<hr>
<table width="100%">
  <tr>
    <td>
    </td>
    <td align="right" valign="center">
      Copyright &copy; 2017 <a href="https://www.eneset.com">Eneset Group Trust</a><br>
    </td>
  </tr>
</table>
</body>
</html>
